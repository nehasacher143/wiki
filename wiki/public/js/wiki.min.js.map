{"version":3,"file":"wiki.min.js","sources":["../../../../apps/wiki/wiki/public/js/edit_wiki.js"],"sourcesContent":["window.EditWiki = class EditWiki extends Wiki {\n\tconstructor() {\n\t\tsuper();\n\t\tfrappe.provide(\"frappe.ui.keys\");\n\t\t$(\"document\").ready(() => {\n\t\t\tfrappe\n\t\t\t\t.call(\"wiki.wiki.doctype.wiki_page.wiki_page.get_sidebar_for_page\", {\n\t\t\t\t\twiki_page: $('[name=\"wiki_page\"]').val(),\n\t\t\t\t})\n\t\t\t\t.then((result) => {\n\t\t\t\t\t$(\".doc-sidebar\").empty().append(result.message);\n\t\t\t\t\tthis.activate_sidebars();\n\t\t\t\t\tthis.set_active_sidebar();\n\t\t\t\t\tthis.set_empty_ul();\n\t\t\t\t\tthis.set_sortable();\n\t\t\t\t\tthis.set_add_item();\n\t\t\t\t\tif ($('[name=\"new\"]').first().val()) {\n\t\t\t\t\t\tthis.add_new_link();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\t}\n\n\tactivate_sidebars() {\n\t\t$(\".sidebar-item\").each(function (index) {\n\t\t\tconst active_class = \"active\";\n\t\t\tlet page_href = window.location.pathname;\n\t\t\tif (page_href.indexOf(\"#\") !== -1) {\n\t\t\t\tpage_href = page_href.slice(0, page_href.indexOf(\"#\"));\n\t\t\t}\n\t\t\tif (page_href.split('/').slice(0,-1).join('/')== $(this).data(\"route\")) {\n\t\t\t\t$(this).addClass(active_class);\n\t\t\t\t$(this).find(\"a\").addClass(active_class);\n\t\t\t}\n\t\t});\n\t\t// scroll the active sidebar item into view\n\t\tlet active_sidebar_item = $(\".sidebar-item.active\");\n\t\tif (active_sidebar_item.length > 0) {\n\t\t\tactive_sidebar_item.get(0).scrollIntoView(true, {\n\t\t\t\tbehavior: \"smooth\",\n\t\t\t\tblock: \"nearest\",\n\t\t\t});\n\t\t}\n\t}\n\n\tset_empty_ul() {\n\t\t$(\".collapsible\").each(function () {\n\t\t\tif ($(this).parent().find(\"ul\").length == 0) {\n\t\t\t\t$(this)\n\t\t\t\t\t.parent()\n\t\t\t\t\t.append(\n\t\t\t\t\t\t$(`<ul class=\"list-unstyled hidden\" style=\"min-height:20px;\"> </ul`)\n\t\t\t\t\t);\n\t\t\t}\n\t\t});\n\t}\n\n\tset_sortable() {\n\t\t$(\".web-sidebar ul\").each(function () {\n\t\t\tnew Sortable(this, {\n\t\t\t\tgroup: {\n\t\t\t\t\tname: \"qux\",\n\t\t\t\t\tput: [\"qux\"],\n\t\t\t\t\tpull: [\"qux\"],\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tset_add_item() {\n\t\t$(`<div class=\"text-muted add-sidebar-item\">+ Add Item</div>`).appendTo(\n\t\t\t$(\".web-sidebar\")\n\t\t);\n\t\tvar me = this;\n\t\t$(\".add-sidebar-item\").click(function () {\n\t\t\tvar dfs = me.get_add_new_item_dialog_fields();\n\n\t\t\tvar dialog = new frappe.ui.Dialog({\n\t\t\t\ttitle: \"Add Components to Sidebar\",\n\t\t\t\tfields: dfs,\n\t\t\t\tprimary_action: function (fields) {\n\t\t\t\t\tif (fields.type == \"Add Wiki Page\") {\n\t\t\t\t\t\tme.add_wiki_page(fields);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.add_wiki_sidebar(fields);\n\t\t\t\t\t}\n\t\t\t\t\tdialog.hide();\n\t\t\t\t},\n\t\t\t});\n\t\t\tdialog.show();\n\t\t});\n\t}\n\n\tget_add_new_item_dialog_fields() {\n\t\treturn [\n\t\t\t{\n\t\t\t\tfieldname: \"type\",\n\t\t\t\tlabel: \"Add Type\",\n\t\t\t\tfieldtype: \"Autocomplete\",\n\t\t\t\toptions: [\"Add Wiki Page\", \"New Wiki Sidebar\"],\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"wiki_page\",\n\t\t\t\tlabel: \"Wiki Page\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Wiki Page\",\n\t\t\t\tdepends_on: \"eval: doc.type=='Add Wiki Page'\",\n\t\t\t\tmandatory_depends_on: \"eval: doc.type=='Add Wiki Page'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"route\",\n\t\t\t\tlabel: \"Name\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tdepends_on: \"eval: doc.type=='New Wiki Sidebar'\",\n\t\t\t\tmandatory_depends_on: \"eval: doc.type=='New Wiki Sidebar'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"title\",\n\t\t\t\tlabel: \"Title\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tdepends_on: \"eval: doc.type=='New Wiki Sidebar'\",\n\t\t\t\tmandatory_depends_on: \"eval: doc.type=='New Wiki Sidebar'\",\n\t\t\t},\n\t\t];\n\t}\n\n\tadd_wiki_page(fields) {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Wiki Page\",\n\t\t\t\tfieldname: \"title\",\n\t\t\t\tfilters: fields.wiki_page,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tlet $new_page = me.get_new_page_html(r, fields);\n\n\t\t\t\t$new_page.appendTo(\n\t\t\t\t\t$(\".doc-sidebar .sidebar-items\")\n\t\t\t\t\t\t.children(\".list-unstyled\")\n\t\t\t\t\t\t.not(\".hidden\")\n\t\t\t\t\t\t.first()\n\t\t\t\t);\n\t\t\t},\n\t\t});\n\t}\n\n\tget_new_page_html(r, fields) {\n\t\treturn $(`\n\t\t<li class=\"sidebar-item\" data-type=\"Wiki Page\"\n\t\t\tdata-name=\"${fields.wiki_page}\" data-new=1 >\n\t\t\t<div>\n\t\t\t\t<div>\n\t\t\t\t\t<a href=\"#\" class=\"green\" >\n\t\t\t\t\t\t\t${r.message.title}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</li>\n\t\t`);\n\t}\n\n\tadd_wiki_sidebar(fields) {\n\t\tlet $new_page = this.get_wiki_sidebar_html(fields);\n\n\t\t$new_page.appendTo(\n\t\t\t$(\".doc-sidebar .sidebar-items\")\n\t\t\t\t.children(\".list-unstyled\")\n\t\t\t\t.not(\".hidden\")\n\t\t\t\t.first()\n\t\t);\n\n\t\t$(\".web-sidebar ul\").each(function () {\n\t\t\tnew Sortable(this, {\n\t\t\t\tgroup: {\n\t\t\t\t\tname: \"qux\",\n\t\t\t\t\tput: [\"qux\"],\n\t\t\t\t\tpull: [\"qux\"],\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tget_wiki_sidebar_html(fields) {\n\t\treturn $(`\n\t\t\t<li class=\"sidebar-group\" data-type=\"Wiki Sidebar\"\n\t\t\t\tdata-name=\"new-sidebar\" data-group-name=\"${fields.route}\"\n\t\t\t\tdata-new=1 data-title=\"${fields.title}\" draggable=\"false\">\n\n\t\t\t\t<div class=\"collapsible\">\n\t\t\t\t\t<span class=\"drop-icon hidden\">\n\t\t\t\t\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t\t\t\t<path d=\"M8 10L12 14L16 10\" stroke=\"#4C5A67\"\n\t\t\t\t\t\t\t\tstroke-miterlimit=\"10\" stroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"></path>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span class=\"drop-left\">\n\t\t\t\t\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t\t\t\t<path d=\"M10 16L14 12L10 8\" stroke=\"#4C5A67\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\" stroke-linejoin=\"round\"></path>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\"h6\">${fields.title}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<ul class=\"list-unstyled hidden\" style=\"min-height:20px;\"> </ul>\n\t\t\t</li>\n\t\t\t`);\n\t}\n\n\tadd_new_link() {\n\t\tlet $new_page = $(`\n\t\t\t<li class=\"sidebar-item\" data-type=\"Wiki Page\" data-name=\"new-wiki-page\" data-new=1 ><div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<a href=\"#\" class=\"green\">New Wiki Page</a>\n\t\t\t\t\t</div></div>\n\t\t\t\t\t</li>\n\t\t`);\n\n\t\t$new_page.appendTo(\n\t\t\t$(\".doc-sidebar .sidebar-items\")\n\t\t\t\t.children(\".list-unstyled\")\n\t\t\t\t.not(\".hidden\")\n\t\t\t\t.first()\n\t\t);\n\t}\n};\n"],"names":["this","const","let"],"mappings":"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"}